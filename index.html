<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Simulación de Control - Lecturas 3</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; background-color: #f9f9f9; }
#quiz-container { max-width: 800px; margin: auto; background: #ffffff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); display: none; }
#progress { display: flex; flex-wrap: wrap; gap: 5px; margin-top: 10px; }
.progress-item { width: 25px; height: 25px; border-radius: 50%; background: #e0e0e0; text-align: center; line-height: 25px; cursor: pointer; font-size: 13px; }
.progress-item.active { background: #007bff; color: white; }
.progress-item.done { background: #28a745; color: white; }
.progress-item.textIntro { background: #ffc107; color: black; font-weight: bold; }
button { background: #007bff; color: white; border: none; padding: 10px 20px; margin-top: 15px; border-radius: 5px; cursor: pointer; }
button:hover { background: #0056b3; }
.correct { color: #28a745; font-weight: bold; }
.incorrect { color: #dc3545; font-weight: bold; }
#start-screen { text-align: center; margin-top: 100px; }
#results { display: none; max-width: 800px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
.question-source { font-size: 13px; color: #555; margin-bottom: 8px; }
</style>
</head>
<body>

<!-- Pantalla de inicio -->
<div id="start-screen">
  <h1>Simulación de Control de Lecturas 3</h1>
  <button id="start-btn">Iniciar simulación</button>
</div>

<!-- Contenedor del quiz -->
<div id="quiz-container">
  <div id="question-number"></div>
  <div id="question-text"></div>
  <div id="options"></div>
  <button id="prev-btn">Anterior</button>
  <button id="next-btn">Siguiente</button>
  <div id="progress"></div>
</div>

<!-- Resultados -->
<div id="results">
  <h2>Resultados</h2>
  <p id="score"></p>
  <p id="grade"></p>
  <div id="detailed-results"></div>
  <button id="restart-btn">Repetir simulación</button>
</div>

<!-- 📘 Banco de preguntas: DEBE IR PRIMERO -->
<script src="control3_questions.js"></script>

<!-- Pequeño puente para compatibilidad -->
<script>
window.baseTF = window.baseTF || window.baseTf || [];
window.baseMC = window.baseMC || window.baseMc || [];
</script>

<!-- 🔥 Lógica principal del simulador -->
<script>
(function(){
let questions = [];
let currentIndex = 0;
let answers = {};
let questionElements = [];
let questionTypes = [];

function startQuiz(){
  document.getElementById('start-screen').style.display = 'none';
  document.getElementById('quiz-container').style.display = 'block';
  buildPool();
  renderQuestion(0);
}

function buildPool(){
  const tfPool = [...window.baseTF];
  const mcPool = [...window.baseMC];
  shuffle(tfPool); shuffle(mcPool);
  let selectedTF = tfPool.slice(0, 20);
  let selectedMC = mcPool.slice(0, 10);
  questions = [...selectedTF, ...selectedMC];
  questions = shuffle(questions);
  questionTypes = questions.map(q => q.hasOwnProperty('options') ? 'mc' : 'tf');
  renderProgress();
}

function renderProgress(){
  const progressDiv = document.getElementById('progress');
  progressDiv.innerHTML = '';
  questions.forEach((_, i) => {
    const item = document.createElement('div');
    item.classList.add('progress-item');
    item.innerText = i+1;
    item.onclick = () => { renderQuestion(i); };
    progressDiv.appendChild(item);
  });
}

function renderQuestion(index){
  currentIndex = index;
  const q = questions[index];
  document.getElementById('question-number').innerHTML = `Pregunta ${index+1} de ${questions.length}`;
const src = q.source ? `<div class='question-source'>${q.source}</div>` : '';
document.getElementById('question-text').innerHTML = `${src}${q.question}`;
  const optionsDiv = document.getElementById('options');
  optionsDiv.innerHTML = '';
  
  if(q.options){
    q.options.forEach((opt, i)=>{
      const btn = document.createElement('button');
      btn.textContent = opt;
      btn.onclick = ()=>selectAnswer(index,i);
      optionsDiv.appendChild(btn);
      optionsDiv.appendChild(document.createElement('br'));
    });
  } else {
    ['Verdadero','Falso','No es relevante'].forEach((opt, i)=>{
      const btn = document.createElement('button');
      btn.textContent = opt;
      btn.onclick = ()=>selectAnswer(index, i===2?'skip':(i===0));
      optionsDiv.appendChild(btn);
      optionsDiv.appendChild(document.createElement('br'));
    });
  }
  updateProgress();
}

function selectAnswer(index, val){
  answers[index] = val;
  if(currentIndex < questions.length - 1) renderQuestion(currentIndex+1);
  else showResults();
}

function updateProgress(){
  document.querySelectorAll('.progress-item').forEach((el, i)=>{
    el.classList.remove('active','done');
    if(i === currentIndex) el.classList.add('active');
    else if(answers.hasOwnProperty(i)) el.classList.add('done');
  });
}

function showResults(){
  document.getElementById('quiz-container').style.display='none';
  document.getElementById('results').style.display='block';
  
  let total=0, correct=0;
  questions.forEach((q,i)=>{
    if(answers[i]!=='skip'){ total++; }
    if(q.options){
      if(answers[i]===q.answer) correct++;
    } else {
      if(answers[i]===q.answer) correct++;
    }
  });
  const percent = ((correct/total)*100).toFixed(1);
  const note = (percent>=80)?7:(percent>=60)?6:(percent>=40)?5:(percent>=20)?4:3;
  
  document.getElementById('score').textContent = `Preguntas correctas: ${correct}/${total} (${percent}%)`;
  document.getElementById('grade').textContent = `Nota estimada: ${note.toFixed(1)}`;
}

function shuffle(array){
  for(let i=array.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [array[i],array[j]]=[array[j],array[i]];
  }
  return array;
}

document.getElementById('start-btn').onclick = startQuiz;
document.getElementById('restart-btn').onclick = ()=>location.reload();
})();
</script>

</body>
</html>
